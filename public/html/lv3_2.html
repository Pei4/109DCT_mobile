<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name=”viewport” content=”width=device-width,initial-scale=0">
    <title>lv3</title>
    <link rel=stylesheet type="text/css" href="../reset.css">
    <link rel="stylesheet" type="text/css" href="../scss/lv3_2.css">
    <link rel="stylesheet" type="text/css" href="../scss/mobile.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="../js/lv3_2.js" crossorigin="anonymous"></script>
    <script src="../js/functions.js"></script>
    <script src="../js/html2canvas.js"></script>
</head>
<body>
<a>拖曳小星球於喜歡的合照位置</a>
<div id="takePhoto"> <!--拍照有關的功能-->
    <video id="view" autoplay loop playsinline></video>
    <div id="capture"> <!--要存檔的東西放這邊-->
        <canvas id="shotCanvas"></canvas>
        <img id="planet0" ontouchstart="down()" ontouchmove="over(event)" ontouchend="up()">
    </div>
    <img id="prepare">
    <button id="shot" class="opt" ontouchstart="screenShot()">拍照</button>
    <button id="rev" class="opt" ontouchstart="reverse()">重拍</button>
</div>
<div id="screen"><br><br><br><br><br><br>請使用行動裝置，以獲取最佳遊戲體驗 :)</div>
</body>
</html>
<script>
    let vid = document.querySelector('#view');
    let canvas = document.querySelector('#shotCanvas')
    let context = canvas.getContext('2d');
    let w, h, ratio;

    function runVid(){
        document.getElementById('planet0').src = `../material/p_A12.png`; //${resStr}
        let constraints = {video: {facingMode: { exact: "user" }}};
        //存取相機
        function handleSuccess(stream) {
            window.stream = stream;
            vid.srcObject = stream;
        }
        function handleError(error) {
            console.log('getUserMedia error: ', error);
        }
        navigator.mediaDevices.getUserMedia(constraints)
            .then(handleSuccess)
            .catch(handleError)
    }
    vid.addEventListener('loadedmetadata', function() {
        ratio = vid.videoWidth / vid.videoHeight;
        w = vid.videoWidth - 100;
        h = parseInt(w / ratio, 10);
        canvas.width = w;
        canvas.height = h;
    }, false);

    function screenShot(){
        //addClass('shotCanvas','after');
        //hideSth('view');
        console.log(vid);
        context.fillRect(0, 0, w, h);
        context.drawImage(vid, 0, 0, w, h);
    };
    function reverse(){
        //addClass('shotCanvas','before');
        //showSth('view');
    }
</script>