<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name=”viewport” content=”width=device-width,initial-scale=0">
    <title>lv3</title>
    <link rel=stylesheet type="text/css" href="../reset.css">
    <link rel="stylesheet" type="text/css" href="../scss/lv3.css">
    <script src="../js/lv3.js"></script>
    <script src="../js/html2canvas.js"></script>
</head>
<body>
<div id="takePhoto"> <!--拍照有關的功能-->
    <div id="capture"> <!--要截圖的東西放這邊-->
        <img id="demoPlanet" src="../material/button_drink.png">
        <video id="preview" autoplay loop playsinline></video>
    </div>
    <canvas id="shotCanvas"></canvas>
    <button onclick="screenShot()"></button>
    <button onclick="runVid()"></button>
</div>
</body>
</html>
<script>
    let vid = document.querySelector('#preview');
    let canvas = document.querySelector('#shotCanvas')
    let context = canvas.getContext('2d');
    let w, h, ratio;

    function runVid(){
        let constraints = {video: {facingMode: { exact: "environment" }}};
        //let video = document.querySelector('#preview');
        //存取相機
        function handleSuccess(stream) {
            window.stream = stream;
            vid.srcObject = stream;
        }
        function handleError(error) {
            console.log('getUserMedia error: ', error);
        }
        navigator.mediaDevices.getUserMedia(constraints)
            .then(handleSuccess)
            .catch(handleError)
    }
    vid.addEventListener('loadedmetadata', function() {
        ratio = vid.videoWidth / vid.videoHeight;
        w = vid.videoWidth - 100;
        h = parseInt(w / ratio, 10);
        canvas.width = w;
        canvas.height = h;
    }, false);

    function screenShot(){
        document.querySelector('#shotCanvas').style.visibility = 'visible';
        context.fillRect(0, 0, w, h);
        context.drawImage(vid, 0, 0, w, h);
    };
</script>